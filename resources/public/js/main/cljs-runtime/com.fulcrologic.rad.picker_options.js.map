{"version":3,"sources":["com/fulcrologic/rad/picker_options.cljc"],"mappings":"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","names":["com.fulcrologic.rad.picker-options/transform-options","com.fulcrologic.fulcro.mutations/->Mutation","com.fulcrologic.fulcro.mutations/mutate","fulcro-mutation-env-symbol","map__73634","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","p__73636","map__73637","*after-render*-orig-val__73639","com.fulcrologic.fulcro.raw.components/*after-render*","*after-render*-temp-val__73640","env","*after-render*-orig-val__73643","*after-render*-temp-val__73644","temp__5735__auto__","com.fulcrologic.fulcro.algorithms.lookup/app-algorithm","default-action","ref","pick-one","state","map__73641","subquery","result","cljs.core/deref","com.fulcrologic.fulcro.algorithms.denormalize/db->tree","com.fulcrologic.fulcro.components.get_query","cljs.core.get_in","transform","options","cljs.core.mapv","cljs.core.swap_BANG_","cljs.core/assoc-in","cljs.core.conj","var_args","G__73646","com.fulcrologic.rad.picker-options/load-picker-options!","js/Error","app-ish","component-class","props","picker-options","com.fulcrologic.rad.picker_options.load_picker_options_BANG_","load-options","map__73647","map__73648","state-atom","app","com.fulcrologic.fulcro.components/any->app","remote","query-key","query-component","cache-key","options-xform","cache-time-ms","query-parameters","params","or__4126__auto__","com.fulcrologic.rad.options_util._QMARK__BANG_","state-map","time-path","target-path","options-path","now","cljs.core/inst-ms","com.fulcrologic.rad.type-support.date-time/now","cached-at","reload?","taoensso.timbre._log_BANG_","taoensso.timbre/*config*","cljs.core/Delay","com.fulcrologic.fulcro.data_fetch.load_BANG_","G__73651","cljs.core.merge","p__73652","map__73653","query-result","raw-result","cljs.core/vec","G__73655","s__63988__auto__","cljs.core.assoc","G__73657","com.fulcrologic.rad.picker-options/load-options!","p__73658","map__73659","form-class","attribute","com.fulcrologic.rad.picker_options.load_options_BANG_","qualified-key","map__73661","field-options","com.fulcrologic.fulcro.components/component-options","G__73664","com.fulcrologic.rad.picker-options/current-picker-options","component-instance","com.fulcrologic.rad.picker_options.current_picker_options","map__73665","coptions","com.fulcrologic.fulcro.components/props","cls","com.fulcrologic.fulcro.components/react-type","and__4115__auto__","js/goog.DEBUG","cljs.core/not","cljs.core/contains?","com.fulcrologic.fulcro.components/component-name","com.fulcrologic.rad.picker-options/current-form-options","form-instance","attr","map__73667","map__73668","map__73669","com.fulcrologic.rad.picker-options/current-options","com.fulcrologic.rad.picker-options/current-to-one-value","map__73673","map__73674","attributes","target-id-key","cljs.core/first","cljs.core.keep","p__73678","map__73679","k","target","cljs.core._EQ_","id","com.fulcrologic.rad.picker-options/current-to-one-label","map__73682","value","text","p1__73681#","cljs.core.filter","js/tr","com.fulcrologic.rad.picker-options/remote","com.fulcrologic.rad.picker-options/query-key","com.fulcrologic.rad.picker-options/query-component","com.fulcrologic.rad.picker-options/query-parameters","com.fulcrologic.rad.picker-options/cache-key","com.fulcrologic.rad.picker-options/options-xform","com.fulcrologic.rad.picker-options/cache-time-ms","com.fulcrologic.rad.picker-options/form","com.fulcrologic.rad.picker-options/allow-edit?","com.fulcrologic.rad.picker-options/allow-create?","com.fulcrologic.rad.picker-options/quick-create"],"sourcesContent":["(ns com.fulcrologic.rad.picker-options\n  \"Utilities to help support entity/enumeration pickers in the UI, along with loading/normalizing/caching the options.\n\n  Pickers are commonly used for things like autocomplete fields and (cascading) dropdowns where the list of options must be loaded dynamically\n  due to some event in the UI.\n\n  Picker options are placed in a well-known top-level table which contains the original query result, the transformed (usable)\n  options, and a timestamp for expiration. UI plugins will query for that table as `[::picker-options/options-cache '_]`\n  which will cause the entire picker options cache to be visible in props.\n\n  Picker options can be used in form fields, report controls, etc.  They are usable anywhere you can link their query\n  in and trigger a load to ensure the options are properly loaded. Picker options can also be statically\n  defined.\n  \"\n  (:require\n    [com.fulcrologic.fulcro.algorithms.denormalize :as fdn]\n    [com.fulcrologic.fulcro-i18n.i18n :refer [tr]]\n    [com.fulcrologic.fulcro.algorithms.normalized-state :as fns]\n    [com.fulcrologic.fulcro.components :as comp :refer [defsc]]\n    [com.fulcrologic.fulcro.data-fetch :as df]\n    [com.fulcrologic.fulcro.mutations :as m :refer [defmutation]]\n    [com.fulcrologic.rad.type-support.date-time :as dt]\n    [com.fulcrologic.rad.attributes :as attr]\n    [com.fulcrologic.rad.options-util :refer [?!]]\n    [taoensso.timbre :as log]\n    [com.fulcrologic.fulcro.application :as app]))\n\n(defmutation transform-options\n  \"INTERNAL MUTATION. Do not use.\"\n  [{:keys  [ref]\n    ::keys [pick-one]}]\n  (action [{:keys [state] :as env}]\n    (let [{:options/keys [subquery]} pick-one\n          result    (:ui/query-result\n                      (fdn/db->tree [{:ui/query-result (comp/get-query subquery)}]\n                        (get-in @state ref) @state))\n          transform (get pick-one :options/transform)\n          options   (if transform\n                      (mapv transform result)\n                      result)]\n      (swap! state assoc-in (conj ref :ui/options) options))))\n\n(defn load-picker-options!\n  \"Load picker options based on raw picker options. This function does all of the picker-centric inner workings\n   of caching and such, so calling this function may do little more than link your component to an existing cached\n   value of options.\n\n   * `app-ish` - An application or live component, used for pulling state and submitting loads.\n   * `component-class` - The component class that will be passed through to the various picker option lambdas.\n   Usually a form or report class, but could also be a UI control.\n   * `props` - The UI props of that will be passed through to the various picker option lambdas. Usually the props\n   of the instance that contains the options.\n   * `picker-options` - A map that contains ::picker-options options. Often the component options, but could also be\n   declared in a control's definition map.\n   * `load-options` - Additional options you wish to pass to the load (optional). Only used if the cache was missing or\n   stale for the options. Currently you cannot use `:target`, `:params`, or `:post-action`. `::picker-options/remote` can\n   be used to select the load remote.\n\n   This function can has general purpose application, and is not report or form specific. It should be called as part of\n   a component's lifecycle to link/populate the options. For example in `componentDidMount` or in a `useEffect` that does\n   has an empty dependency vector (one-shot on mount).\n   \"\n  ([app-ish component-class props picker-options] (load-picker-options! app-ish component-class props picker-options {}))\n  ([app-ish component-class props picker-options load-options]\n   (let [{::app/keys [state-atom] :as app} (comp/any->app app-ish)\n         {::keys [remote query-key query-component cache-key options-xform cache-time-ms query-parameters]} picker-options\n         params        (or (?! query-parameters app component-class props) {})\n         cache-time-ms (or cache-time-ms 100)\n         state-map     @state-atom\n         cache-key     (or (?! cache-key component-class props) query-key)\n         time-path     [::options-cache cache-key :cached-at]\n         target-path   [::options-cache cache-key :query-result]\n         options-path  [::options-cache cache-key :options]\n         now           (inst-ms (dt/now))\n         cached-at     (get-in state-map time-path 0)\n         reload?       (or (:force-reload? load-options) (> (- now cached-at) cache-time-ms))]\n     (when-not query-key\n       (log/error \"Cannot load picker options because there is no query-key.\"))\n     (when-not query-component\n       (log/warn \"Cannot load picker options because ::query-component is missing.\"))\n     (swap! state-atom assoc-in time-path now)\n     (when reload?\n       (df/load! app-ish query-key query-component\n         (cond-> (merge load-options\n                   {:target      target-path\n                    :params      params\n                    :post-action (fn [{:keys [state result]}]\n                                   (let [query-result (get-in @state target-path)\n                                         raw-result   (get-in result [:body query-key])\n                                         options      (vec\n                                                        (cond-> query-result\n                                                          options-xform (options-xform raw-result)))]\n                                     (fns/swap!-> state\n                                       (assoc-in options-path options))))})\n           remote (assoc :remote remote)))))))\n\n(defn load-options!\n  \"Load picker options into the options cache for a form field. This should be used by the UI implementation of\n  a form field to ensure picker options are loaded. Typically you'll call this in a component lifecycle method (or one-shot\n  effect hook).\n\n  * `app-ish` - Anything you can `transact!` against\n  * `form-class` - The form that holds the field for which you are loading options (passed to picker option lambdas)\n  * `props` - The ui props of the form (passed to the picker option lambdas)\n  * `attribute` - A RAD attribute that could contain picker options, and also designates data that the field will\n  be picking.\n  * `load-options` - Additional options to pass to load if the options are loaded. Some options may be overridden\n  internally. See `load-picker-options!`.\n\n  The picker options will be a combination of the field options for the field and any found on the attribute.\"\n  ([app-ish form-class props attribute] (load-options! app-ish form-class props attribute {}))\n  ([app-ish form-class props {:com.fulcrologic.rad.attributes/keys [qualified-key] :as attribute} load-options]\n   (let [{:com.fulcrologic.rad.form/keys [field-options]} (comp/component-options form-class)\n         field-options  (get field-options qualified-key)\n         picker-options (merge attribute field-options)]\n     (load-picker-options! app-ish form-class props picker-options load-options))))\n\n(defn current-picker-options\n  \"Gets the current picker options (when not using a form). See `current-form-options` for a form-specific variant.\n\n  `component-instance` - A mounted component whose props will contain the picker options table (e.g. the link query\n  `[::picker-options/options-cache '_]`). This instance can also have picker options in its `component-options`.\n  `picker-options` - Optional. A map that contains picker option (overrides). Will be merged (as overrides) for any that are found in\n  component options on the component instance. Note that since this function does no loading, this is only useful if your\n  original picker options are not on the same component as the query.\n  \"\n  ([component-instance] (current-picker-options component-instance {}))\n  ([component-instance picker-options]\n   (let [coptions       (comp/component-options component-instance)\n         picker-options (merge coptions picker-options)\n         props          (comp/props component-instance)\n         {::keys [cache-key query-key]} picker-options\n         cls            (comp/react-type component-instance)\n         cache-key      (or (?! cache-key cls props) query-key)\n         options        (get-in props [::options-cache cache-key :options])]\n     (when (and #?(:cljs goog.DEBUG :clj true)\n             (not cache-key))\n       (log/error \"Could not find picker option for cache or query key in options: \" picker-options))\n     (when (and #?(:cljs goog.DEBUG :clj true)\n             (not (contains? props ::options-cache)))\n       (log/warn \"No options cache found in props for\" (comp/component-name cls) \". This could mean options have not been \"\n         \"loaded, or that you forgot to put `[::picker-options/options-cache '_]` on your query. NOTE: This warning can be \"\n         \"a false alarm if the application just started and no picker options have yet been loaded.\"))\n     options)))\n\n(defn current-form-options\n  \"Gets the current picker options for the given form-instance and attribute.\"\n  [form-instance attr]\n  (let [{:com.fulcrologic.rad.form/keys [field-options]} (comp/component-options form-instance)\n        {:com.fulcrologic.rad.attributes/keys [qualified-key]} attr\n        field-options (get field-options qualified-key)\n        {::keys [cache-key query-key]} (merge attr field-options)\n        cache-key     (or (?! cache-key (comp/react-type form-instance) (comp/props form-instance)) query-key)\n        cache-key     (or cache-key query-key (log/error \"Ref field MUST have either a ::picker-options/cache-key or ::picker-options/query-key in attribute \" qualified-key))\n        props         (comp/props form-instance)\n        options       (get-in props [::options-cache cache-key :options])]\n    options))\n\n(def current-options \"DEPRECATED NAME: Use current-form-options\" current-form-options)\n\n(defn current-to-one-value\n  \"Returns the current to-one ref value for the given reference attribute as an ident.\"\n  [form-instance attr]\n  (let [{:com.fulcrologic.rad.form/keys [attributes]} (comp/component-options form-instance)\n        {::attr/keys [qualified-key]} attr\n        target-id-key (first (keep (fn [{k ::attr/qualified-key ::attr/keys [target]}]\n                                     (when (= k qualified-key) target)) attributes))\n        props         (comp/props form-instance)\n        id            (get-in props [qualified-key target-id-key])]\n    (when id\n      [target-id-key id])))\n\n(defn current-to-one-label\n  \"Extracts the current to-one label from the given attribute's value via the picker options\"\n  [form-instance attr]\n  (let [options (current-form-options form-instance attr)\n        value   (current-to-one-value form-instance attr)\n        {:keys [text]} (first (filter #(= (:value %) value) options))]\n    (str (or text (tr \"UNSELECTED\")))))\n\n(def remote\n  \"The keyword name of the remote that the picker options are loaded from. Defaults to :remote.\"\n  ::remote)\n\n(def query-key\n  \"The top-level query keyword to use when pulling the options.\"\n  ::query-key)\n\n(def query-component\n  \"A Fulcro defsc with the subquery to use for pulling options.\"\n  ::query-component)\n\n(def query-parameters\n  \"A map of query parameters to include in the option load, or a `(fn [app cls props] map?)` that can generate those\n   props on demand.\"\n  ::query-parameters)\n\n(def cache-key\n  \"A keyword or `(fn [cls props] keyword?)` under which the normalized picker options will be saved.\"\n  ::cache-key)\n\n(def options-xform\n  \"A `(fn [normalized-result raw-result] [{:text t :value v} ...])`. This generates the options to show the user. If\n  not provided then it is assumed that the query result itself is a vector of these text/value pair maps.\"\n  ::options-xform)\n\n(def cache-time-ms\n  \"How long the options can be cached. This allows multiple uses of the same options load to be used over time. Caching\n  is done under ::cache-key.\"\n  ::cache-time-ms)\n\n(def form\n  \"Picker option (e.g. for fo/field-options). If present (and the rendering plugin supports it) this option names the class\n   of a `defsc-form` that CAN be used to create or edit instances of the type being picked. Including this option\n   automatically infers that creation should be allowed (rendering plugins should automatically show a way to trigger\n   the creation of a new element).\"\n  ::form)\n\n(def allow-edit?\n  \"Picker option (e.g. for fo/field-options). Requires po/form. Indicates that editing of a picked item should be possible.\n   Requires support from rendering plugin.\n\n   Boolean or `(fn [parent-instance parent-relation] bool)`\"\n  ::allow-edit?)\n\n(def allow-create?\n  \"Picker option (e.g. for fo/field-options). Requires po/form. Indicates that creating a new picked item should be possible.\n   Requires support from rendering plugin.\n\n   Boolean or `(fn [parent-instance parent-relation] bool)`\"\n  ::allow-create?)\n\n(def quick-create\n  \"Picker option (e.g. for fo/field-options).\n\n   A `(fn [parent-instance parent-relation] entity-with-tempid)` that must return an entity that can be immediately saved to the server\n   via `form/save!`. You MUST give the entity a tempid.\n\n   `po/form` is not required and is not used.\n\n   CAN be combined with allow-create?, allow-edit?, but that will enable both buttons for edit/create as well as\n   the ability to type a string and quick-add it.\"\n  ::quick-create)\n"]}